<!doctype html>

<html>

<head>

<meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title><{$pageTitle}></title>

<{if $pageKeywords}><meta name="keywords" content="<{$pageKeywords}>" /><{/if}>

<{if $pageDescription}><meta name="description" content="<{$pageDescription}>" /><{/if}>

<link rel="stylesheet" type="text/css" href="<{$SKIN_PATH}>css/web_global.css" />

<script type="text/javascript" src="<{$SKIN_PATH}>js/jquery-1.8.2.min.js"></script>

<script type="text/javascript" src="<{$SKIN_PATH}>js/droplist.js"></script>

<script type="text/javascript" language="javascript" src="<{$STATIC_PATH}>DatePicker/My97DatePicker/WdatePicker.js"></script>

<!--[if lt IE 7]><script src="<{$SKIN_PATH}>js/iepng.js"></script><![endif]-->

</head>

<body>


<{include file='header.htm'}>


<div class="container">

	<div class="wrap clearfix">

		<{include file='company/side.htm'}>

		<div class="main">

			<div class="box2">

					<select class='chooseDate'>
						<option>请选择日期</option>
						<{foreach from=$availableDates item=d}>
							<option value="<{$d}>" <{if $d==$date}>selected<{/if}>>
								<{$d}>
							</option>
						<{/foreach}>
					</select>
					
					

					<{if $orders}>
						<button style="padding: 10px 5px;background: #FD5001 ">  
							<a onclick='return confirm("确认生成统配号?");'	href="<{$http_root_www}>company/oproute?date=<{$date}>&task=generate_logistic_sequence">生成统配号</a>
						</button>

						<button style="padding: 10px 5px;background: #FD5001 ">
							<a onclick='return confirm("确认将一下订单导入OptimoRoute?");'	href="<{$http_root_www}>company/oproute?date=<{$date}>&task=syncup">Sync Up auto routes</a>
						</button>
						
						<button style="padding: 10px 5px;background: #FD5001 ">
							<a onclick='return confirm("确认将一下订单导入OptimoRoute?");'	href="<{$http_root_www}>company/oproute?auto=1&date=<{$date}>&task=syncup">Sync Up manual routes</a>
						</button>

						<button style="padding: 10px 5px;background: #43d1af">
							<a onclick='return confirm("确认将OptimoRoute的订路线信息导入CityB2B?");'href="<{$http_root_www}>company/oproute?date=<{$date}>&task=syncdown">Sync Down</a>
						</button>
                   <!--
						<button style="padding: 10px 5px;background: #eee">
							<a onclick='return confirm("确认向用户推送配送ETA?");'href="<{$http_root_www}>company/oproute?date=<{$date}>&task=notifyuser">一键发货</a>
						</button>  --> 
						<button style="padding: 10px 5px;background: #ff659a">
							<a onclick='return confirm("确认兑付全部订单？");'href="<{$http_root_www}>company/oproute?date=<{$date}>&task=approveall">全部兑付</a>
						</button>
						<{if $loginUser.id ==7666666666}>
						<button style="padding: 10px 5px;background: #65dfff">
							<a onclick='return confirm("确认将全部订单同步至Freshx？统配号将自动生成");'href="<{$http_root_www}>company/oproute?date=<{$date}>&task=freshx_import">订单同步至Freshx</a>
						</button>
						<{/if}>

						<button style="padding: 10px 5px;background: #65dfff">
							<a onclick='return confirm("Label 打印需要定制的打印机，如果您没有请联系微奖网客服。");'href="<{$http_root_www}>company/labelprint?date=<{$date}>" target='_blank'>Label 打印</a>
						</button>
					<{/if}>
					<div class="main-list">	

					<{if $orders}>				
						<table cellspacing="0" cellpadding="0" width="100%">
							<thead>				
								<tr>			
									<th>订单号</th>
									<th>地址</th>
									<th>姓名</th>
									<th>电话</th>

									<th style="background: #FD5001 ">统配号</th>	

									<th style="background: #43d1af">Truck</th>	
									<th style="background: #43d1af">Driver</th>
									<th style="background: #43d1af">Stop</th>
									<th style="background: #43d1af">ETA</th>
<!--  
									<th style="background: #65dfff">FreshX Order Id</th>	 -->
								</tr>			
							</thead>		
							<tbody>		
								<{foreach from=$orders item=item name='dl'}>		
								<tr<{if $smarty.foreach.dl.index%2==0}> class="odd"<{/if}>>		
									<td>
										<a target='_blank' href="<{$http_root_www}>company/customer_order_detail?id=<{$item.orderId}>"><{$item.orderId}></a>
									</td>
									<td><{$item.address}></td>
									<td><{$item.first_name}> <{$item.last_name}></td>
									<td><{$item.phone}></td>

									<td>
										<{if $item.logistic_sequence_No == 0}>
											-
										<{else}>
											<{$item.logistic_sequence_No}>
										<{/if}>
									</td>

									<td><{$item.logistic_truck_No}></td>
									<td><{$item.logistic_driver_code}></td>
									<td><{$item.logistic_stop_No}></td>
									<td>
										<{if $item.logisitic_schedule_time == 0}>
											-
										<{else}>
											<{$item.logisitic_schedule_time|date_format:'%I:%M %p'}>
										<{/if}>
									</td>

							<!--		<td>
										<{if $item.freshx_order_id>0}>
											<{$item.freshx_order_id}> （已同步）
											<button class='freshx_order_update_ajax' data-freshx-order-id = '<{$item.freshx_order_id}>'>更新</button>
										<{else}>
											未同步
										<{/if}>	
									</td>  -->
									
								</tr>			
								<{/foreach}>			
							</tbody>		
						</table>	
					<{/if}>
				</div>	

				<div style="padding: 20px">
					<p>OptimoRoute控制面板适用说明</p>
					<p>Step 1:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;选择一个递送日期，系统会弹出当天需要递送的全部订单，确认地址和用户信息无误</p>
					<p>Step 2:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;并生成统配号以及 logistic suppliers count/info</p>
					<p>Step 3:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Sync up 将把系统订单推送至OptimoRoute</p>
					<p>Step 4:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;登陆OptimoRoute后台，生成路线</p>
					<p>Step 5:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Sync down 将把OptimoRoute规划好的路线信息同步至系统, 并生Truck,Driver,Stop和ETA</p>
					<p>Step 6:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;一键发货 将群发商家发货邮件和微信推送</p>
					<p>Step 7:</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;兑付全部订单 物流结束后，对于取消的订单需要手动进入订单详情中取消，剩余订单确认无误后一键全部兑付</p>
				</div>
				
			</div>

		</div>

	</div>

</div>


<{include file='footer.htm'}>
<script type="text/javascript">
	$(function(){
		$('.chooseDate').on('change', function(){
			if ($(this).val()) 
				window.location.href = "<{$http_root_www}>company/oproute?date=" + $(this).val();
		});
	})
</script>



<script type="text/javascript">
	$(function(){
		$('.freshx_order_update_ajax').on('click', function(){
			var freshx_order_id =  $(this).data('freshx-order-id');
			var self = this;
			$.ajax({
				url:"/company/freshx_order_update_ajax",
				type:"GET",
				data:{"freshx_order_id":freshx_order_id},
				beforeSend:function(){
					$(self).html('<i style="color:#FD5001 " class="fa fa-spinner fa-spin"></i>');
				}
			}).done(function(d){
			    $(self).html('已更新');
			});
		})
	})
</script>

</body>

</html>