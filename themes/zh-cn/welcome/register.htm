<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title><{$lang->register}></title>
	<meta name="keywords" content="<{$lang->register}>"/>
	<meta name="description" content="<{$lang->register}>"/>

	<!-- Elegant font icons -->
	<link href="<{$SKIN_PATH}>welcome/assets/vendor/elegant_font/HTMLCSS/style.css" rel="stylesheet">

	<!-- Elegant font icons -->
	<link href="<{$SKIN_PATH}>welcome/assets/vendor/materializeicon/material-icons.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="<{$SKIN_PATH}>welcome/assets/css/style-amber.css" rel="stylesheet" id="style">
	<link rel="stylesheet" href="<{$STATIC_PATH}>ccp/build/css/intlTelInput.css">
	<link rel="stylesheet" type="text/css" href="<{$SKIN_PATH}>common.css"/>
	<style>
        .loader-logo .logo {
            background-color: transparent;
        }

        #verify-code, #mobile, #username, #email {
            border-top-left-radius: 50px;
            border-bottom-left-radius: 50px;
        }

        .banner-hero {
            overflow: auto;
        }
        /*wechat login css*/
        .wx_login {
            position: relative;
        }

        .wx_login_item {
            position: relative;
            display: inline-block;
            color: white;
            background: #74bd36;
            width: 100%;
            height: 100%;
            top: 10px;

            text-align: center;
            line-height: 120px;
            font-size: 13px;
            text-decoration: none;
        }

        .wx_logo {
            background-image: url(<{$SKIN_PATH}>images/wx_logo_64_x_64.png);
        }
	</style>
</head>
<body class="ui-rounded">
<div class="head bgfff center">
	<img src="<{$SKIN_PATH}>img/return.png" class="return" onclick="window.history.go(-1);"/>
	<span ><{$lang->register}></span>
</div>
<!-- Begin page content -->
<main class="flex-shrink-0 main-container">
	<!-- page content goes here -->
	<div class="banner-hero vh-100 scroll-y bg-white">
		<div class="container h-100 text-white">
			<div class="row h-100 h-sm-auto">
				<div class="col-12 col-md-8 col-lg-5 col-xl-4 mx-auto align-self-center text-center">
					<div class="loader-logo mr-4">
					<!--	<div class="logo">
							<a href="<{$http_root_www}>"><img style="height:56px;width:135px;" src="<{$SKIN_PATH}><{$lang->logo_path}>" alt="<{$site.name}>"/></a>
						</div> -->
						<h4 class="logo-text text-default">
						</h4>
					</div>
					<br>
					<br>
					<form id="register-form" action="<{$http_root_www}>member/register">
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<button id="register-gateway" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true"
										aria-expanded="false">
								</button>
								<div class="dropdown-menu" style="">
									<a id="account-register" class="dropdown-item register-gateway text-dark" data-register-gateway="account" href="#"><{$lang->account_register}></a>
									<a id="mobile-register" class="dropdown-item register-gateway text-dark" data-register-gateway="mobile" href="#"><{$lang->mobile_register}></a>
									<a id="email-register" class="dropdown-item register-gateway text-dark" data-register-gateway="email" href="#"><{$lang->email_register}></a>
								</div>
							</div>
							<label for="mobile" class="sr-only"><{$lang->mobile_phone_number}></label>
							<input type="text" id="mobile" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->mobile_phone_number}>" autofocus>
							<label for="username" class="sr-only"><{$lang->user_name}></label>
							<input type="text" id="username" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->user_name}>" autofocus>
							<label for="email" class="sr-only"><{$lang->email}></label>
							<input type="email" id="email" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->email}>" autofocus>
						</div>
						<div class="form-group">
							<label for="password" class="sr-only"><{$lang->password}></label>
							<input type="password" id="password" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->password}>">
						</div>
						<div class="form-group reset">
							<label for="confirm-password" class="sr-only"><{$lang->confirm_password}></label>
							<input type="password" id="confirm-password" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->confirm_password}>">
						</div>
						<div class="input-group mb-3">
							<label for="verify-code" class="sr-only"><{$lang->verify_code}></label>
							<input type="text" id="verify-code" class="form-control form-control-lg border-0 bg-light" placeholder="<{$lang->verify_code}>">
							<div class="input-group-append">
								<button id="get-verify-code-button" class="btn btn-outline-secondary" type="button"><{$lang->remind_user_register_10}></button>
							</div>
						</div>
						<div class="form-group">
							<p class="text-danger" id="error-message"><br></p>
						</div>

						<div class="my-3 row">
							<div class="col-12 col-md py-1 text-left">
								<div class="custom-control custom-checkbox">
									<input type="checkbox" class="custom-control-input" id="agree">
									<label class="custom-control-label text-dark" for="agree"><{$lang->i_have_agreed_with}> 《<a class="text-dark" href="<{$http_root_www}>member1/terms" ><{$lang->term_and_condition}></a>》</label>
								</div>
							</div>
						</div>

						<div class="mb-4">
							<button type="submit" id="register-button" class="btn btn-lg btn-default default-shadow btn-block">
								<{$lang->register}>
								<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
								<span class="ml-2 icon arrow_right"></span>
							</button>
						</div>
					</form>
					<div class="mb-4 text-dark">
						<p><{$lang->already_have_account}>?<br><{$lang->click}> <a href="<{$http_root_www}>member/login?returnUrl=<{$returnUrl}>"
																					  class="text-default"><{$lang->log_in}></a></p>
					</div>
                  <!--
					<div class='wx_login'>
						<div class="swiper-slide w-auto p-2">
							<div data-toggle="modal" data-target="#wechat-login">
								<a class="icons icon-60 shadow-sm bg-white wx_logo">
								</a>
								<p class="small mt-2 text-success"><{$lang->wechat_log_in}></p>
							</div>
						</div>
					</div> -->
				</div>
			</div>
		</div>
	</div>

	<!-- Wechat login Modal -->
	<!--<div class="modal fade" id="wechat-login" tabindex="-1" role="dialog" aria-labelledby="wechat-login-title" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="wechat-login-title"><{$lang->wx_scan_log_in}></h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<img id='wx_login_mask' src='<{$loginQrcode}>'>
				</div>
			</div>
		</div>
	</div> -->
</main>
<!-- End of page content -->

<!-- Required jquery and libraries -->
<script src="<{$SKIN_PATH}>welcome/assets/js/jquery-3.3.1.min.js"></script>
<script src="<{$SKIN_PATH}>welcome/assets/js/popper.min.js"></script>
<script src="<{$SKIN_PATH}>welcome/assets/vendor/bootstrap-4.4.1/js/bootstrap.min.js"></script>

<!-- cookie js -->
<script src="<{$SKIN_PATH}>welcome/assets/vendor/cookie/jquery.cookie.js"></script>

<!-- Customized jquery file  -->
<script src="<{$SKIN_PATH}>welcome/assets/js/main.js"></script>

<!-- Wechat login Js -->
<script>
    var id='<{$pc_login_id}>';

    function check_wechat_login() {
        $.post('<{$http_root_www}>query?cmd=check_weixin_login', {'id':id}, function(data){
            if(data.trim()=='VALID') {
                window.location.href = '<{if $returnUrl}><{urldecode($returnUrl)}><{else}><{$http_root_www}><{/if}>';
            }
            setTimeout(function(){check_wechat_login();}, 2000);
        });
    }
    check_wechat_login();
</script>

<!-- Custom Js -->
<script src="<{$SKIN_PATH}>welcome/assets/js/common.js"></script>
<script>
    const errorMessage = $('#error-message');
    const registerForm = $('#register-form')
    const username = $('#username');
    const mobile = $('#mobile');
    const email = $('#email');
    const password = $('#password');
    const confirmPassword = $('#confirm-password');
    const verifyCode = $('#verify-code');
    const emailRegister = $('#email-register');
    const mobileRegister = $('#mobile-register');
    const accountRegister = $('#account-register');
    const getVerifyCodeButton = $('#get-verify-code-button');
    const registerButton = $('#register-button');

    function changeRegisterGateway(gateway) {
        switch ($(gateway).data('register-gateway')) {
            case 'account':
                registerForm.attr('register-type', 'account');
                username.show();
                username.attr('required', true);//required need to remove if disable for browser submit check
                password.show();
                password.attr('required', true);
                confirmPassword.show();
                confirmPassword.attr('required', true);
                mobile.hide();
                mobile.removeAttr('required');
                email.hide();
                email.removeAttr('required');
                verifyCode.hide();
                verifyCode.removeAttr('required');
                getVerifyCodeButton.hide();
                registerButton.attr('disabled', false);
                break;
            case 'mobile':
                registerForm.attr('register-type', 'mobile');
                mobile.show();
                mobile.attr('required', true);
                verifyCode.show();
                verifyCode.attr('required', true);
                getVerifyCodeButton.show();
                email.hide();
                email.removeAttr('required');
                username.hide();
                username.removeAttr('required');
                password.hide();
                password.removeAttr('required');
                confirmPassword.hide();
                confirmPassword.removeAttr('required');
                registerButton.attr('disabled', true);
                break;
            case 'email':
                registerForm.attr('register-type', 'email');
                email.show();
                email.attr('required', true);
                verifyCode.show();
                verifyCode.attr('required', true);
                getVerifyCodeButton.show();
                mobile.hide();
                mobile.removeAttr('required');
                username.hide();
                username.removeAttr('required');
                password.hide();
                password.removeAttr('required');
                confirmPassword.hide();
                confirmPassword.removeAttr('required');
                registerButton.attr('disabled', true);
                break;
        }

        $('#register-gateway').html($(gateway).html());
    }

    registerForm.submit(function () {
        errorMessage.html('<br>');

        let url = registerForm.attr('action') + '?type=';

        let registerData = {
            agree: $('#agree').prop("checked") ? 1 : 0,
            returnUrl: '<{$returnUrl}>'
        }
        switch (registerForm.attr('register-type')) {
            case 'account':
                url += 'normal';
                registerData.name = username.val();
                registerData.password = password.val();
                registerData.passwordAgain = confirmPassword.val();
                break;
            case 'mobile':
                url += 'mobile';
                registerData.mobile = mobile.val();
                registerData.code = verifyCode.val();
                registerData.password = password.val();
                registerData.passwordAgain = confirmPassword.val();
                break;
            case 'email':
                url += 'email';
                registerData.email = email.val();
                registerData.code = verifyCode.val();
                registerData.password = password.val();
                registerData.passwordAgain = confirmPassword.val();
                break;
        }

        $.ajax({
            url: url,
            data: registerData,
            type: "POST",
            beforeSend : function() {
                isButtonLoading(true, registerButton)
            },
            success: function (data) {
                data = JSON.parse(data);

                if (data.status === 200) {
                    window.location.href = data.redirect;
                } else if (data['msg']) {
                    errorMessage.html(data['msg']);
                }
            },
        }).done(function () {
            isButtonLoading(false, registerButton)
        });

        return false;
    })

    getVerifyCodeButton.on('click', function () {
        errorMessage.html('<br>');

        let url;
        switch (registerForm.attr('register-type')) {
            case 'email':
                if (email.val() === '') {
                    errorMessage.html('<{$lang->remind_user_register_15}>');
                    return false;
                }
                url = "<{$http_root_www}>system/send_email_verification_code?email=" + email.val();
                break;
            case 'mobile':
                if (mobile.val() === '') {
                    errorMessage.html('<{$lang->input_mobile_number}>');
                    return false;
                }

                const regAUS = /^(0)?[0-8]\d{8}$/g//Australia mobile format check
                if (!regAUS.test(mobile.val())) {
                    errorMessage.html('<{$lang->only_10_digital_phone}>');
                    return false;
                }
                let full_number = '+61' + mobile.val().slice(-9);// +61400500600
				url = "<{$http_root_www}>system/send_sms_login_verification_code?mobile=" + mobile.val() + "&full_number=" + full_number;
                break;
        }

        getVerifyCodeButton.html('<{$lang->remind_user_register_10}>...');
        $.get(url, function () {
            verifyCodeButtonCutDown();
            password.show();
            password.attr('required', true);
            confirmPassword.show();
            confirmPassword.attr('required', true);
            registerButton.attr('disabled', false);
        });
    })

    function verifyCodeButtonCutDown() {
        getVerifyCodeButton.prop('disabled', true);
        let time = 60;

        let timeCutDown = setInterval(function () {
            time--;
            getVerifyCodeButton.html('<{$lang->remind_user_register_10}>(' + time + 's)');

            if (time === 0) {
                clearInterval(timeCutDown);
                getVerifyCodeButton.html('<{$lang->remind_user_register_10}>');
                getVerifyCodeButton.prop('disabled', false);
            }
        }, 1000)
    }

    document.addEventListener("DOMContentLoaded", function () {
        mobileRegister.on('click', function () {
            changeRegisterGateway(this);
        });
        accountRegister.on('click', function () {
            changeRegisterGateway(this);
        });
        emailRegister.on('click', function () {
            changeRegisterGateway(this);
        });

        accountRegister.trigger('click');
        isButtonLoading(false, registerButton);
    });
</script>
</body>

</html>
