<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
		

	    <title>佳丽排名</title>
	    <style>
	    	#sortMiss{
	    		margin: 0px auto;
	    		padding-top: 30px;
	    		padding-bottom: 30px;
	    		position: relative;
	    		width: 100%;
	    		height: 780px;
	    		text-align: center; 
	    		background-image: url(/themes/zh-cn/brandstore/2019miss/miss2/img/bg.png);
	    		background-size: 100% 100%;
	    		display: flex;
	    		
	    	}
	    	.left-time{
	    		flex: 1;
	    		position: absolute;
	    		left: 20px;
	    		width: 250px;
	    		height: 250px;
	    		/*border: 3px solid #825ea6;*/
	    		border-radius: 15px;
	    		color: #825ea6;
	    		vertical-align: middle;
	    	}
	    	.left-time-wrap{
	    		width: 20px;
	    		float: left;
	    		position: absolute;
	    		font-size: 22px;
	    		text-align: center;
	    	}
	    	.middle-photo{
	    		flex: 2;
	    	}
	    	.item{
	    		position: relative;
	    		display: inline-block;
	    		
	    	}
	    	.item-wrap{
	    		position: relative;
	    		height: 80px;
	    		width: 80px;
	    		border-radius: 40px;
	    		margin: 10px 28px;
	    		overflow: hidden;
	    	}
	    	.imgs{
	    		width: 100%;
	    		height: 100%;
	    	}
	    	.name{
	    		position: absolute;
	    		left: 0;
	    		bottom: 0;
	    		padding-bottom: 5px;
	    		background-color: white;
	    		color: black;
	    		width: 100%;
	    		font-size: 12px;
	    	}
	    	.hg{
	    		position: absolute;
	    		top: -7px;
	    		right: 13px;
	    	}
	    	.right-table{
	    		flex: 1;
	    		margin-right: 40px;
	    		width: 600px;
	    		color: #4b4171;
	    	}
	    	.isScale{
	    		/*transition: all 1s;
	    		
	    		  -moz-transform: scale(0.8);
				  -webkit-transform: scale(0.8);
				  -o-transform: scale(0.8) ;
				  -ms-transform: scale(0.8) ;
				  transform: scale(0.8) ;*/
				 color: red;
				 opacity: 0.5;
	    	}
	    	
	    	.ul-style{
	    		display: flex; 
	    		list-style: none;
	    		padding-left: 0px;
				font-size: 22px;
			font-weight: 600;
	    	}
	    	.ul-style li{
	    		flex: 1;
	    		background-color: #5b4e4e;
	    		padding: 5px;
	    		
	    	}
	    	.li-wrap{
	    		display: inline-block;
			    border: 1px solid ;
			    box-shadow: 0px 0px 30px 2px #825ea6;
			    width: 26px;
			    height: 26px;
			    border-radius: 28px;
	    	}
	    </style>
		
	</head>
	<body>
			<div id="sortMiss">
				<!--<div class="left-time">
					<div style="font-size: 40px;">决赛</div>
					<div class="left-time-wrap" style="left: 45px;">
						<span style="color: #d87227;font-size: 30px;">7</span>月
						<span style="color: #d87227;font-size: 30px;">25</span>日周四晚
						<span style="color: #d87227;font-size: 30px;">7</span>点</div>
					<div class="left-time-wrap" style="left: 100px;">
						倒计时<span style="color: #d87227;font-size: 30px;">{{days}}</span>天
					</div>
				</div>-->
				<div class="left-time">
					<img src="/themes/zh-cn/brandstore/2019miss/miss2/img/scode.jpg" width="100%" height="auto"/>
					<h2>扫码投票</h2>
				</div>
				<div class="middle-photo" style="margin-top:50px;">
				<div v-for="(items,i) in trangleList" >
					<div class="item" v-for="(item,j) in items">
						<div class="item-wrap">
							<img class="imgs" :src='item.imgsrc'/>
								<div class="name" style="font-size:16px;font-weight:600;">{{item.no}}</div>
						</div>
						<div class="hg" v-if="i < 2">
							<img  :src="'/themes/zh-cn/brandstore/2019miss/miss2/img/' + (i*(j+1) + 1) + '.png'" width="30px" height="30px"/>
						</div>
					</div> 
				</div>
				</div>
				<div class="right-table">
					<h2 style="color: #825ea6; border: 4px  white;border-style:dotted solid; width: 100%;">排行榜 Ubonus365.com  微奖网</h2>
						<!--<table style="width: 100%;color: black;" border="0" cellspacing="0" cellpadding="10">
							<tr v-for="(item,index) in tableList" v-if="index<=9">
								<td>{{index+1}}</td>
								<td>{{item.name}}</td>
								<td>{{item.total_count}}</td>
							</tr>
						</table>-->
						<ul  class="ul-style" :class="item.differ" v-for="(item,index) in tableList" v-if="index<=9" >
							<li style="flex:1;"><span class="li-wrap">{{index+1}}</span></li>
							<li style="flex:2;">{{item.name}}</li>
							<li style="flex:1;">{{item.total_count}}</li>
						</ul>
				</div>
			</div>
	</body>
	<script type="text/javascript" src="/themes/zh-cn/brandstore/2019miss/miss2/js/jquery-1.12.4.min.js" ></script>
		<script type="text/javascript" src="/themes/zh-cn/brandstore/2019miss/miss2/js/vue.min.js" ></script>
		
		<script>
		var leftTime = (new Date('2019-07-25')) - new Date(); //计算剩余的毫秒数
		var days = parseInt(leftTime / 1000 / 60 / 60 / 24, 10)+1; //计算剩余的天数
		var datas=[
		  {old_total_count:0,total_count:0,num:1,no:1,zhibo_id:24,votes:473,name:'1 Kassie 孙嘉宜',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/Kassie孙嘉宜.jpg'},
			{old_total_count:0,total_count:0,num:2,no:2,zhibo_id:1,votes:437,name:'2 Susan 何诗莹',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/何诗莹(Susan).JPG'},
			{old_total_count:0,total_count:0,num:3,no:3,zhibo_id:10,votes:464,name:'3 Mindy 张鸣宇',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/张鸣宇Mindy.jpg'},
			{old_total_count:0,total_count:0,num:4,no:4,zhibo_id:33,votes:475,name:'4 Stacey 原嘉懿',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/原嘉懿Stacey.jpg'},
			{old_total_count:0,total_count:0,num:5,no:5,zhibo_id:20,votes:456,name:'5 Athena 孙寒秋',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/孙寒秋Athena.jpg'},
			{old_total_count:0,total_count:0,num:6,no:6,zhibo_id:27,votes:430,name:'6 Endora 黄衫',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/黄衫(Endora).jpg'},
			{old_total_count:0,total_count:0,num:7,no:7,zhibo_id:7,votes:470,name:'7 Carmen 李佳雯',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/李佳雯Carmen.jpg'},
			{old_total_count:0,total_count:0,num:8,no:8,zhibo_id:9,votes:479,name:'8 Fiona 周豫昕',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/Fiona_周豫昕.jpg'},
			{old_total_count:0,total_count:0,num:9,no:9,zhibo_id:12,votes:438,name:'9 Natalie 秋雅田',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/秋雅田(Natalie).JPG'},
			{old_total_count:0,total_count:0,num:10,no:10,zhibo_id:13,votes:440,name:'10 Angela 沈安琪',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/沈安琪(Angela).JPG'},
			{old_total_count:0,total_count:0,num:11,no:11,zhibo_id:11,votes:431,name:'11 Catherin 谭嘉歆',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/谭嘉歆（Catherine）.jpg'},
			{old_total_count:0,total_count:0,num:12,no:12,zhibo_id:16,votes:439,name:'12 Michelle 陈彦君',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/陈彦君(Michelle).JPG'},
			{old_total_count:0,total_count:0,num:13,no:13,zhibo_id:23,votes:468,name:'13 Pythia 胡雯婧',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/胡雯婧Pythia.jpg'},
			{old_total_count:0,total_count:0,num:14,no:14,zhibo_id:6,votes:463,name:'14 Sophia 代悦',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/代悦Sophia.jpg'},
			{old_total_count:0,total_count:0,num:15,no:15,zhibo_id:8,votes:453,name:'15 Wendy 吴美霖',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/吴美霖(Wendy).jpg'},
			{old_total_count:0,total_count:0,num:16,no:16,zhibo_id:0,votes:489,name:'16 Amy 李亚蓉',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/李亚蓉Amy.jpg'},
			{old_total_count:0,total_count:0,num:17,no:17,zhibo_id:4,votes:483,name:'17 Jessica 李瞳',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/李瞳Jessica.jpg'},
			{old_total_count:0,total_count:0,num:18,no:18,zhibo_id:32,votes:485,name:'18 Josie 杜卓曈',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/杜卓曈Josie.jpg'},
			{old_total_count:0,total_count:0,num:19,no:19,zhibo_id:15,votes:455,name:'19 Jennifer 赵婉君',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/赵婉君Jennifer.jpg'},
			{old_total_count:0,total_count:0,num:20,no:20,zhibo_id:30,votes:482,name:'20 Cecilia 曹玺',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/曹玺Cecilia.jpg'},
			{old_total_count:0,total_count:0,num:21,no:21,zhibo_id:0,votes:501,name:'21 summer 倪飘飘',ubonus_count:0,zhibo_count:0,imgsrc:'/themes/zh-cn/brandstore/2019miss/img/倪飘飘summer.jpg'}
						
						
		],trangleList=[];
				new Vue({
					el:'#sortMiss',
					data:{
						datas,//原始data
						days,
						trangleList,//三角
						tableList:[],//表格
						isScale:false,
					},
					mounted:function(){
						this.refresh_vote(9);
               			this.refresh_vote_zhibo();
					},
					methods:{
						refresh_vote:function(group_id){
							var _this=this;
						   	var group_id=group_id;
							$.ajax({
								url:"https://ubonus365.com/coupon/get_ajax_vote_rank?group_id="+group_id,
								type:"GET",
								beforeSend:function(){
								},
							}).done(function(data){
							   	var newdata=JSON.parse(data);
								$.each(newdata,function(i,n){  
									// 将Ubonus 的最新数据发送给总的选手统计信息数组中。
									_this.send_ubonus_vote(n);
								})
								_this.tableList=[].concat(datas)
								var copyData = [].concat(datas),
								trangleList = [];
								while (copyData.length>0){
									trangleList.push(copyData.splice(0,trangleList.length+1))
								}
								_this.trangleList = [].concat(trangleList);
								$.each(_this.tableList, function(i,item) {
									if(_this.tableList[i].total_count!=_this.tableList[i].old_total_count){
										_this.tableList[i].old_total_count=_this.tableList[i].total_count
										Object.assign(item,{'differ':'differ'});
										console.log(datas[i].differ)
										console.log(_this.tableList[i].old_total_count)
									}else{
										Object.assign(item,{'differ':''});
									}
								});
								
							}).always(function(){
							})			
							setInterval(()=>this.twinkle(),500)
							setTimeout(()=>this.refresh_vote(9),5000);
						},
						twinkle:function(){
							$('.differ').css('color','#fceb10');  //默认值
							setTimeout(" $('.differ').css('color','#ff0606')",300); //第一次闪烁
							setTimeout( "$('.differ').css('color','#ccc')",200); //第二次闪烁 
						},
						send_ubonus_vote:function(vote_data){
							var _this=this;
						    $.each(datas,function(i,n){  
								  if(vote_data.id ==n.votes) {
								  // 如果在数组中找到该选手，则更新该选手在统计中Ubonus票数
									n.ubonus_count=vote_data.vote_count;
									if (n.votes==439) n.zhibo_count=100000;
									n.total_count=parseInt(n.ubonus_count) +parseInt(n.zhibo_count);
								  }								  
							})
						     datas.sort(this.compare('total_count',false))
						},
						refresh_vote_zhibo:function(){
							var _this=this;
							$.ajax({
				                url: "//mp.jingchang.tv/live/api/getPlayerList?page=1&num=50&callback=callback",
				                dataType: "jsonp",
				                jsonp:"callback",
				                success: function (res) {
									 $.each(res.data,function(i,n){  
										// 将Ubonus 的最新数据发送给总的选手统计信息数组中。
										_this.send_zhibo_vote(n);
									})
									
				                }
				            });
							setTimeout(()=>this.refresh_vote_zhibo(),5000);
						},
						send_zhibo_vote:function(zhibo_data){
							var _this=this
						    $.each(datas,function(i,n){  
								if(zhibo_data.player_no ==n.zhibo_id) {
								  // 如果在数组中找到该选手，则更新该选手在统计中Ubonus票数
									n.zhibo_count=zhibo_data.vote_count;
										if (n.votes==439) n.zhibo_count=100000;
									n.total_count=parseInt(n.ubonus_count) +parseInt(n.zhibo_count);
								}
							})
						    datas.sort(this.compare('total_count',false))
						    
						},
						compare:function( property, desc ) {
							return function ( a, b ) {
								var value1 = a[ property ];
								var value2 = b[ property ];
								if ( desc == true ) {                    
									//排序升序排列                   
									return value1 - value2;           
								} else {                     
									return value2 - value1;
								}
							}
						}
					}
				}) 
				
				
		</script>
	
</html>
